<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Research - Test Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .status-banner {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .status-banner h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .status-item {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .status-item.healthy {
            border-left-color: #10b981;
        }

        .status-item.warning {
            border-left-color: #f59e0b;
        }

        .status-item label {
            display: block;
            font-size: 0.85em;
            color: #666;
            margin-bottom: 4px;
        }

        .status-item strong {
            color: #333;
            font-size: 1em;
        }

        .chat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .input-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            min-height: 100px;
            transition: border-color 0.3s;
        }

        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            flex: 1;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .example-queries {
            margin-top: 15px;
        }

        .example-queries h4 {
            margin-bottom: 10px;
            color: #666;
            font-size: 0.9em;
        }

        .example-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }

        .example-btn {
            padding: 12px;
            background: #f8f9fa;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
        }

        .example-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .response-area {
            margin-top: 20px;
            display: none;
        }

        .response-area.show {
            display: block;
        }

        .response-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .response-header h3 {
            color: #333;
        }

        .response-time {
            color: #666;
            font-size: 0.9em;
        }

        .response-content {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            white-space: pre-wrap;
            line-height: 1.8;
            color: #333;
            max-height: 500px;
            overflow-y: auto;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f4f6;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #dc2626;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .info-card h3 {
            color: #333;
            margin-bottom: 15px;
        }

        .info-list {
            list-style: none;
        }

        .info-list li {
            padding: 8px 0;
            color: #666;
            border-bottom: 1px solid #e5e7eb;
        }

        .info-list li:last-child {
            border-bottom: none;
        }

        .info-list li strong {
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Financial Research</h1>
            <p>AI-powered financial analysis using yfinance (100% FREE)</p>
        </div>

        <div class="status-banner">
            <h3>System Status</h3>
            <div class="status-grid" id="statusGrid">
                <div class="status-item">
                    <label>Status</label>
                    <strong id="statusText">Checking...</strong>
                </div>
                <div class="status-item">
                    <label>Data Provider</label>
                    <strong id="providerText">-</strong>
                </div>
                <div class="status-item">
                    <label>OpenAI</label>
                    <strong id="openaiText">-</strong>
                </div>
                <div class="status-item">
                    <label>yfinance</label>
                    <strong id="yfinanceText">-</strong>
                </div>
            </div>
        </div>

        <div class="chat-card">
            <div class="input-group">
                <label for="queryInput">Ask a financial question:</label>
                <textarea
                    id="queryInput"
                    placeholder="Example: What was Apple's revenue growth over the last 4 quarters?"
                ></textarea>
            </div>

            <div class="button-group">
                <button class="btn-primary" id="submitBtn" onclick="submitQuery()">
                    Ask 
                </button>
                <button class="btn-secondary" onclick="clearQuery()">
                    Clear
                </button>
            </div>

            <div class="example-queries">
                <h4>Example Queries:</h4>
                <div class="example-grid">
                    <button class="example-btn" onclick="setQuery(this.textContent)">
                        What is Tesla's current stock price?
                    </button>
                    <button class="example-btn" onclick="setQuery(this.textContent)">
                        Show me Microsoft's quarterly revenue trend
                    </button>
                    <button class="example-btn" onclick="setQuery(this.textContent)">
                        Compare Amazon and Google's market cap
                    </button>
                    <button class="example-btn" onclick="setQuery(this.textContent)">
                        What was NVIDIA's revenue growth in 2024?
                    </button>
                </div>
            </div>

            <div class="response-area" id="responseArea">
                <div class="response-header">
                    <h3>Response</h3>
                    <span class="response-time" id="responseTime"></span>
                </div>
                <div class="response-content" id="responseContent"></div>
            </div>
        </div>

        <div class="info-card">
            <h3>ðŸ’° Cost-Free Financial Data</h3>
            <ul class="info-list">
                <li><strong>yfinance:</strong> 100% FREE - No API key needed, unlimited queries</li>
                <li><strong>OpenAI API:</strong> ~$0.01-0.10 per query (depending on complexity)</li>
                <li><strong>Total Cost:</strong> Only OpenAI API usage (yfinance is completely free)</li>
                <li><strong>Alternative:</strong> Financial Datasets API available ($29-99/month if needed)</li>
            </ul>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';

        // Check system status on load
        async function checkHealth() {
            try {
                const response = await fetch(`${API_BASE}/api/health`);
                const data = await response.json();

                document.getElementById('statusText').textContent = data.status;
                document.getElementById('providerText').textContent = data.api_keys_configured.data_provider;
                document.getElementById('openaiText').textContent = data.api_keys_configured.openai;
                document.getElementById('yfinanceText').textContent = data.api_keys_configured.yfinance;

                // Update status colors
                const statusItems = document.querySelectorAll('.status-item');
                statusItems[0].classList.add(data.status === 'healthy' ? 'healthy' : 'warning');
            } catch (error) {
                document.getElementById('statusText').textContent = 'Error';
                console.error('Health check failed:', error);
            }
        }

        function setQuery(query) {
            document.getElementById('queryInput').value = query;
        }

        function clearQuery() {
            document.getElementById('queryInput').value = '';
            document.getElementById('responseArea').classList.remove('show');
        }

        async function submitQuery() {
            const query = document.getElementById('queryInput').value.trim();
            if (!query) {
                alert('Please enter a question');
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            const responseArea = document.getElementById('responseArea');
            const responseContent = document.getElementById('responseContent');
            const responseTime = document.getElementById('responseTime');

            // Show loading state
            submitBtn.disabled = true;
            submitBtn.textContent = 'Thinking...';
            responseArea.classList.add('show');
            responseContent.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';

            const startTime = Date.now();

            try {
                const response = await fetch(`${API_BASE}/api/query`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        query: query,
                        max_steps: 20
                    })
                });

                const data = await response.json();
                const duration = ((Date.now() - startTime) / 1000).toFixed(1);

                responseTime.textContent = `Completed in ${duration}s`;

                if (data.status === 'success') {
                    responseContent.textContent = data.answer;
                } else {
                    responseContent.innerHTML = `<div class="error-message"><strong>Error:</strong> ${data.error}</div>`;
                }
            } catch (error) {
                responseContent.innerHTML = `<div class="error-message"><strong>Error:</strong> ${error.message}</div>`;
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Ask';
            }
        }

        // Allow Enter to submit (Ctrl+Enter for new line)
        document.getElementById('queryInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.ctrlKey && !e.shiftKey) {
                e.preventDefault();
                submitQuery();
            }
        });

        // Check health on load
        checkHealth();
    </script>
</body>
</html>
